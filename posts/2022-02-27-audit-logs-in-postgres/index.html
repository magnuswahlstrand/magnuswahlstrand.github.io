<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="canonical" href="https://wahlstrand.dev/posts/2022-02-27-audit-logs-in-postgres/"><meta name="generator" content="Astro v4.15.12"><!-- General Meta Tags --><title>Audit tables in Postgres</title><meta name="title" content="Audit tables in Postgres"><meta name="description" content="Made by a minimal, responsible and friendly person."><meta name="author" content="Magnus Wahlstrand"><!-- Open Graph / Facebook --><meta property="og:title" content="Audit tables in Postgres"><meta property="og:description" content="Made by a minimal, responsible and friendly person."><meta property="og:url" content="https://wahlstrand.dev/posts/2022-02-27-audit-logs-in-postgres/"><meta property="og:image" content="https://wahlstrand.dev/default-og.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://wahlstrand.dev/posts/2022-02-27-audit-logs-in-postgres/"><meta property="twitter:title" content="Audit tables in Postgres"><meta property="twitter:description" content="Made by a minimal, responsible and friendly person."><meta property="twitter:image" content="https://wahlstrand.dev/default-og.png"><!-- Google Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><script>
      const primaryColorScheme = "none"; // "light" | "dark" | "none"

      const darkModeMediaQuery = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;

      // Get theme data from local storage
      const currentTheme = localStorage.getItem("theme");

      let theme;

      // Set theme to 'theme-dark' if currentTheme is 'dark'
      if (currentTheme) {
        theme = currentTheme === "dark" ? "theme-dark" : "";
      } else {
        // If primary color scheme is dark
        // or primary color scheme is not set and prefers-color-scheme is dark
        // choose dark mode
        if (
          primaryColorScheme === "dark" ||
          (primaryColorScheme === "none" && darkModeMediaQuery)
        ) {
          theme = "theme-dark";
        }
        // If primary color scheme is light
        // choose light mode
        else if (primaryColorScheme === "light") {
          theme = "";
        }
        // fallback to prefers-color-scheme
        else {
          theme = darkModeMediaQuery ? "theme-dark" : "";
        }
      }

      // Put dark class on html tag to enable dark mode
      document.querySelector("html").className = theme;
    </script><link rel="stylesheet" href="/_astro/about.BnN8G_Cd.css">
<link rel="stylesheet" href="/_astro/about.Ykqo9j5q.css">
<style>.breadcrumb[data-astro-cid-ilhxcym7]{margin-left:auto;margin-right:auto;margin-top:2rem;margin-bottom:.25rem;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]{display:inline;text-transform:capitalize;opacity:.7}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]+li[data-astro-cid-ilhxcym7]{--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]+li[data-astro-cid-ilhxcym7]:before{--tw-content: ">";content:var(--tw-content)}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]:not(:last-child):hover{opacity:1}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]:not(:last-child):hover:before{content:var(--tw-content);opacity:.7}#main-content[data-astro-cid-hsp6otuf]{margin-left:auto;margin-right:auto;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem;padding-bottom:3rem}#main-content[data-astro-cid-hsp6otuf] h1[data-astro-cid-hsp6otuf]{font-size:1.5rem;line-height:2rem;font-weight:600}@media (min-width: 640px){#main-content[data-astro-cid-hsp6otuf] h1[data-astro-cid-hsp6otuf]{font-size:1.875rem;line-height:2.25rem}}#main-content[data-astro-cid-hsp6otuf] p[data-astro-cid-hsp6otuf]{margin-top:.5rem;margin-bottom:1.5rem;font-style:italic}
a[data-astro-cid-blwjyjpt]{position:relative;text-decoration-line:underline;text-decoration-style:dashed}a[data-astro-cid-blwjyjpt]:hover{top:-.125rem;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}a[data-astro-cid-blwjyjpt]:focus-visible{padding:.25rem}a[data-astro-cid-blwjyjpt] svg[data-astro-cid-blwjyjpt]{margin-right:-1rem;height:1.5rem;width:1.5rem;--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity));opacity:.8}.group[data-astro-cid-blwjyjpt]:hover a[data-astro-cid-blwjyjpt] svg[data-astro-cid-blwjyjpt]{fill:rgb(var(--color-accent))}
.col-1[data-astro-cid-vj4tpspi]{display:none}@media (min-width: 1280px){.col-1[data-astro-cid-vj4tpspi]{grid-column:span 3 / span 3;display:block}}.col-2[data-astro-cid-vj4tpspi]{grid-column:span 12 / span 12;padding-left:1rem;padding-right:1rem}@media (min-width: 1024px){.col-2[data-astro-cid-vj4tpspi]{grid-column:span 9 / span 9}}@media (min-width: 1280px){.col-2[data-astro-cid-vj4tpspi]{grid-column:span 6 / span 6}}.col-3[data-astro-cid-vj4tpspi]{display:none}@media (min-width: 1024px){.col-3[data-astro-cid-vj4tpspi]{grid-column:span 3 / span 3;display:block}}main[data-astro-cid-vj4tpspi]{margin-left:auto;margin-right:auto;width:100%;padding-left:.5rem;padding-right:.5rem;padding-bottom:3rem}#main-content-wrapper[data-astro-cid-vj4tpspi]{margin-left:auto;margin-right:auto}.post-title[data-astro-cid-vj4tpspi]{font-size:1.5rem;line-height:2rem;font-weight:600;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}.tags-container[data-astro-cid-vj4tpspi]{margin-top:.25rem;margin-bottom:.25rem;font-size:.875rem;line-height:1.25rem}.toc[data-astro-cid-vj4tpspi]{border-left-width:2px;padding-left:1rem;font-size:.75rem;line-height:1rem}
.pagination-wrapper[data-astro-cid-eenky23y]{margin-top:auto;margin-bottom:2rem;display:flex;justify-content:center}.disabled[data-astro-cid-eenky23y]{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.5}.disabled[data-astro-cid-eenky23y]:hover{--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.group[data-astro-cid-eenky23y]:hover .disabled[data-astro-cid-eenky23y]{fill:rgb(var(--color-text-base))}.group[data-astro-cid-eenky23y]:hover .disabled-svg[data-astro-cid-eenky23y]{fill:rgb(var(--color-text-base))!important}
.link-button[data-astro-cid-mm6olqhn]:hover{--tw-rotate: 6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}
</style>
<link rel="stylesheet" href="/_astro/_slug_.DUJDte-_.css"><script type="module" src="/_astro/hoisted.yKWdqxaI.js"></script></head> <body>  <header data-astro-cid-3ef6ksr2> <a id="skip-to-content" href="#main-content" data-astro-cid-3ef6ksr2>Skip to content</a> <div class="nav-container" data-astro-cid-3ef6ksr2> <div class="top-nav-wrap" data-astro-cid-3ef6ksr2> <a href="/" class="logo break-keep text-2xl" data-astro-cid-3ef6ksr2> Magnus Wahlstrand </a> <button class="hamburger-menu" aria-label="menu" data-astro-cid-3ef6ksr2> <div class="icon-container flex" data-astro-cid-3ef6ksr2> <div id="first-line" data-astro-cid-3ef6ksr2></div> <div id="second-line" data-astro-cid-3ef6ksr2></div> <div id="third-line" data-astro-cid-3ef6ksr2></div> </div> </button> </div> <nav class="display-none sm:flex" data-astro-cid-3ef6ksr2> <ul data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/resume" class="" data-astro-cid-3ef6ksr2>Resum√©</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/posts" class="" data-astro-cid-3ef6ksr2>Posts</a> </li> <!--
        <li>
          <a href="/tags" class={activeNav === "tags" ? "active" : ""}>Tags</a>
        </li>
        --> <li data-astro-cid-3ef6ksr2> <a href="/about" class="" data-astro-cid-3ef6ksr2>About</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/now" class="" data-astro-cid-3ef6ksr2>Now</a> </li> </ul> <div class="button-wrapper sm:display-none" data-astro-cid-3ef6ksr2> <a type="button" href="/search" class="group focus-outline p-1 " aria-label="search" title="Search" data-astro-cid-5eunqzkt>  <svg xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" data-astro-cid-3ef6ksr2></path> </svg>  </a>  <button id="theme-btn" class="focus-outline" aria-label="switch theme" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" id="moon-svg" data-astro-cid-3ef6ksr2> <path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z" data-astro-cid-3ef6ksr2></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" id="sun-svg" data-astro-cid-3ef6ksr2> <path d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z" data-astro-cid-3ef6ksr2></path> </svg> </button> </div> </nav> </div> <div class="max-w-3xl mx-auto px-4"> <hr class="border-skin-line"> </div> </header>   <div class="" data-astro-cid-vj4tpspi> <div class="mx-auto grid grid-cols-12 max-w-7xl" data-astro-cid-vj4tpspi> <div class="col-1" data-astro-cid-vj4tpspi></div> <div class="col-2" data-astro-cid-vj4tpspi> <button class="mt-8 mb-2 hover:opacity-75 flex focus-outline" onclick="history.back()"> <svg xmlns="http://www.w3.org/2000/svg"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"></path> </svg> <span>Go back</span> </button> <div class="justify-start mx-auto" data-astro-cid-vj4tpspi> <h1 class="post-title" data-astro-cid-vj4tpspi>Audit tables in Postgres</h1> <div class="opacity-80 flex items-center space-x-2 my-2"><svg xmlns="http://www.w3.org/2000/svg" class="scale-100 w-6 h-6 inline-block fill-skin-base"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg><span class="italic text-base">February 27, 2022</span></div> <ul class="tags-container" data-astro-cid-vj4tpspi> <li class="inline-block my-1 underline-offset-4" data-astro-cid-blwjyjpt> <a href="/tags/postgres" class="pr-1 text-xs group" data-astro-cid-blwjyjpt> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75" data-astro-cid-blwjyjpt> <path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" data-astro-cid-blwjyjpt></path> </svg>
&nbsp;<span data-astro-cid-blwjyjpt>postgres</span> </a> </li> <li class="inline-block my-1 underline-offset-4" data-astro-cid-blwjyjpt> <a href="/tags/cdc" class="pr-1 text-xs group" data-astro-cid-blwjyjpt> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75" data-astro-cid-blwjyjpt> <path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" data-astro-cid-blwjyjpt></path> </svg>
&nbsp;<span data-astro-cid-blwjyjpt>cdc</span> </a> </li>  </ul> </div> </div> <div class="col-3" data-astro-cid-vj4tpspi></div> </div> <div class="mx-auto grid grid-cols-12 max-w-7xl mt-4" data-astro-cid-vj4tpspi> <!--Col 1 --> <div class="col-1" data-astro-cid-vj4tpspi></div> <!--Col 2 --> <div class="col-2" data-astro-cid-vj4tpspi> <div data-astro-cid-vj4tpspi> <article id="article" role="article" class="prose max-w-3xl mb-24" data-astro-cid-vj4tpspi> <p>A while back I watched <a href="https://www.youtube.com/watch?v=j6ow-UemzBc">this video</a> (summary <a href="https://www.infoq.com/news/2018/07/bryzek-microservice-architecture/">here</a>) with Michael Bryzek (Flow.io, Gilt). He presented how they do <a href="https://en.wikipedia.org/wiki/Change_data_capture">Change Data Capture</a> (CDC) with PostgreSQL and DynamoDB. One goal with CDC is that changes to databases rows and tables can be propagated to other parts of the system. In microservices systems, this can be used to build read-projections, or just keep local caches of data.</p>
<p><a href="https://www.postgresql.org/">Postgres</a> is one of my favorite databases to work with in production (and probably the one I most experience with), but I have little or experience working features such as PostgreSQL triggers and stored procedures. In this blog post, I explore how to use triggers to create a simple audit table in Postgres.</p>
<!--more-->
<h4 id="why-do-you-need-an-audit-table">Why do you need an audit table?</h4>
<ul>
<li>Customer support might need the information to answer customer support requests. They might need to answer questions such as <strong>why</strong> their data is in the current state, and <strong>when</strong> it was changed and by <strong>whom</strong>.
was updated.</li>
<li>You (the engineer) might want to answer the same questions when debugging üòâ</li>
<li>You can use the audit table to build more complex functionality, such as propagating changes to other parts of the system.</li>
</ul>
<p>Let‚Äôs get started!</p>
<h3 id="the-tables">The tables</h3>
<p>Let us say that the user profiles are stored in the <code>profile</code> table.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">TABLE</span><span class="space"> </span><span style="color:#61AFEF">profile</span></span>
<span class="line"><span style="color:#ABB2BF">(</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">id</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">INT</span><span class="space"> </span><span style="color:#C678DD">GENERATED</span><span class="space"> </span><span style="color:#C678DD">ALWAYS</span><span class="space"> </span><span style="color:#C678DD">AS</span><span class="space"> </span><span style="color:#C678DD">IDENTITY</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">name</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">VARCHAR</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">40</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">email</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">VARCHAR</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">40</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">PRIMARY</span><span class="space"> </span><span style="color:#C678DD">KEY</span><span class="space"> </span><span style="color:#ABB2BF">(id)</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE TABLE profile
(
    id         INT GENERATED ALWAYS AS IDENTITY,
    name       VARCHAR(40) NOT NULL,
    email      VARCHAR(40) NOT NULL,
    PRIMARY KEY (id)
);
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>We also set up the <code>profile_audits</code>.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">TABLE</span><span class="space"> </span><span style="color:#61AFEF">profile_audits</span></span>
<span class="line"><span style="color:#ABB2BF">(</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">id</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">INT</span><span class="space"> </span><span style="color:#C678DD">GENERATED</span><span class="space"> </span><span style="color:#C678DD">ALWAYS</span><span class="space"> </span><span style="color:#C678DD">AS</span><span class="space"> </span><span style="color:#C678DD">IDENTITY</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">operation</span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">VARCHAR</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">40</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">row</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">jsonb</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">changed_on</span><span class="space"> </span><span style="color:#C678DD">TIMESTAMP</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">6</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE TABLE profile_audits
(
    id         INT GENERATED ALWAYS AS IDENTITY,
    operation  VARCHAR(40)  NOT NULL,
    row        jsonb        NOT NULL,
    changed_on TIMESTAMP(6) NOT NULL
);
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p><strong>*Note:</strong> Our <code>profile_audits</code> can contain any columns we want. I chose a single <code>row</code> column to store the full changed row because 1) it is easy 2) we don‚Äôt have to worry about schema changes to the <code>profile</code> table.*</p>
<h3 id="linking-the-two-tables">Linking the two tables</h3>
<p>The goal is to be able to track changes to the <code>profile</code> table, and store them in <code>profile_audit</code>. For this we need</p>
<ol>
<li>A <a href="https://www.postgresql.org/docs/9.1/sql-createtrigger.html">postgres trigger</a> that listen to changes to
the <code>profile</code> table. From the documentation:</li>
</ol>
<blockquote>
<p>CREATE TRIGGER creates a new trigger. The trigger will be associated with the specified table or view and will execute the specified function function_name when certain events occur.</p>
</blockquote>
<ol start="2">
<li>We also need a <a href="https://www.postgresql.org/docs/9.5/sql-createfunction.html">postgres function</a> to called by the
trigger.</li>
</ol>
<p>First, let‚Äôs define the function:</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">OR</span><span class="space"> </span><span style="color:#C678DD">REPLACE</span><span class="space"> </span><span style="color:#C678DD">FUNCTION</span><span class="space"> </span><span style="color:#61AFEF">log_profile_changes</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">RETURNS</span><span class="space"> </span><span style="color:#ABB2BF">TRIGGER</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">LANGUAGE</span><span class="space"> </span><span style="color:#ABB2BF">PLPGSQL</span></span>
<span class="line"><span style="color:#C678DD">AS</span></span>
<span class="line"><span style="color:#ABB2BF">$$</span></span>
<span class="line"><span style="color:#C678DD">BEGIN</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">RAISE</span><span class="space"> </span><span style="color:#ABB2BF">EXCEPTION</span><span class="space"> </span><span style="color:#98C379">'not</span><span class="space"> </span><span style="color:#98C379">implemented</span><span class="space"> </span><span style="color:#98C379">:-)'</span></span>
<span class="line"><span style="color:#C678DD">END</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">$$</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE OR REPLACE FUNCTION log_profile_changes()
    RETURNS TRIGGER
    LANGUAGE PLPGSQL
AS
$$
BEGIN
    RAISE EXCEPTION &#x27;not implemented :-)&#x27;
END;
$$
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>The function will just raise an exception, for now.</p>
<p>Next we set up our trigger. The following makes sure <code>log_profile_changes</code> is called on <code>INSERTS</code> and <code>UPDATES</code> to
the <code>profile</code> table.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">TRIGGER</span><span class="space"> </span><span style="color:#61AFEF">profile_changes</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">BEFORE</span><span class="space"> </span><span style="color:#C678DD">INSERT</span><span class="space"> </span><span style="color:#C678DD">OR</span><span class="space"> </span><span style="color:#C678DD">UPDATE</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">ON</span><span class="space"> </span><span style="color:#C678DD">profile</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">FOR</span><span class="space"> </span><span style="color:#ABB2BF">EACH</span><span class="space"> </span><span style="color:#C678DD">ROW</span></span>
<span class="line"><span style="color:#C678DD">EXECUTE</span><span class="space"> </span><span style="color:#C678DD">PROCEDURE</span><span class="space"> </span><span style="color:#ABB2BF">log_profile_changes();</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE TRIGGER profile_changes
    BEFORE INSERT OR UPDATE
    ON profile
    FOR EACH ROW
EXECUTE PROCEDURE log_profile_changes();
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>We can try our trigger by doing an insert to the <code>profile</code> table.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">INSERT</span><span class="space"> </span><span style="color:#C678DD">INTO</span><span class="space"> </span><span style="color:#C678DD">profile</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">name</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#ABB2BF">email)</span><span class="space"> </span><span style="color:#C678DD">VALUES</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'Magnus'</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#98C379">'magnus@gmail.com'</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span></code><button class="copy" data-code="INSERT INTO profile (name, email) VALUES (&#x27;Magnus&#x27;, &#x27;magnus@gmail.com&#x27;);
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>This results in:</p>
<blockquote>
<p>[P0001] ERROR: not implemented :-) Where: PL/pgSQL function log_profile_changes() line 3 at RAISE</p>
</blockquote>
<p>Success! This is the exception <code>not implemented :-)</code> from our function.</p>
<p>Now we know that the basic setup works as expected, we can update our function to make inserts to the audit table. We
have access to several variables inside the trigger. We are interested in <code>NEW</code> and <code>TG_OP</code>. <em>Complete list of variables <a href="https://www.postgresql.org/docs/9.1/plpgsql-trigger.html">here</a>.</em></p>
<ul>
<li><strong>NEW</strong> - Data type RECORD; variable holding the new database row for INSERT/UPDATE operations in row-level triggers.
This variable is NULL in statement-level triggers and for DELETE operations.</li>
<li><strong>TG_OP</strong> - Data type text; a string of INSERT, UPDATE, DELETE, or TRUNCATE telling for which operation the trigger
was fired.</li>
</ul>
<p>The new function:</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">OR</span><span class="space"> </span><span style="color:#C678DD">REPLACE</span><span class="space"> </span><span style="color:#C678DD">FUNCTION</span><span class="space"> </span><span style="color:#61AFEF">log_profile_changes</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#C678DD">RETURNS</span><span class="space"> </span><span style="color:#ABB2BF">TRIGGER</span></span>
<span class="line"><span style="color:#C678DD">LANGUAGE</span><span class="space"> </span><span style="color:#ABB2BF">PLPGSQL</span></span>
<span class="line"><span style="color:#C678DD">AS</span></span>
<span class="line"><span style="color:#ABB2BF">$$</span></span>
<span class="line"><span style="color:#C678DD">BEGIN</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">IF</span><span class="space"> </span><span style="color:#ABB2BF">(TG_OP</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#98C379">'INSERT'</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">OR</span><span class="space"> </span><span style="color:#ABB2BF">(TG_OP</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#98C379">'UPDATE'</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">THEN</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">INSERT</span><span class="space"> </span><span style="color:#C678DD">INTO</span><span class="space"> </span><span style="color:#ABB2BF">profile_audits(operation,</span><span class="space"> </span><span style="color:#C678DD">row</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#ABB2BF">changed_on)</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">VALUES</span><span class="space"> </span><span style="color:#ABB2BF">(TG_OP,</span><span class="space"> </span><span style="color:#ABB2BF">to_jsonb(NEW),</span><span class="space"> </span><span style="color:#C678DD">now</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">END</span><span class="space"> </span><span style="color:#C678DD">IF</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">RETURN</span><span class="space"> </span><span style="color:#ABB2BF">NEW;</span></span>
<span class="line"><span style="color:#C678DD">END</span><span class="space"> </span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">$$</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE OR REPLACE FUNCTION log_profile_changes()
RETURNS TRIGGER
LANGUAGE PLPGSQL
AS
$$
BEGIN

    IF (TG_OP = &#x27;INSERT&#x27;) OR (TG_OP = &#x27;UPDATE&#x27;) THEN
        INSERT INTO profile_audits(operation, row, changed_on)
        VALUES (TG_OP, to_jsonb(NEW), now());
    END IF;

    RETURN NEW;
END ;
$$
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h3 id="testing-everything">Testing everything</h3>
<p>We can test our trigger with an insert and an update.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">INSERT</span><span class="space"> </span><span style="color:#C678DD">INTO</span><span class="space"> </span><span style="color:#C678DD">profile</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">name</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#ABB2BF">email)</span><span class="space"> </span><span style="color:#C678DD">VALUES</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#98C379">'Magnus'</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#98C379">'magnus@gmail.com'</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">UPDATE</span><span class="space"> </span><span style="color:#C678DD">profile</span><span class="space"> </span><span style="color:#C678DD">SET</span><span class="space"> </span><span style="color:#ABB2BF">email</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#98C379">'magnus2@gmail.com'</span><span class="space"> </span><span style="color:#C678DD">WHERE</span><span class="space"> </span><span style="color:#C678DD">name</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#98C379">'Magnus'</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span></code><button class="copy" data-code="INSERT INTO profile (name, email) VALUES (&#x27;Magnus&#x27;, &#x27;magnus@gmail.com&#x27;);
UPDATE profile SET email = &#x27;magnus2@gmail.com&#x27; WHERE name = &#x27;Magnus&#x27;;
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p><strong>Result 1</strong></p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">SELECT</span><span class="space"> </span><span style="color:#ABB2BF">*</span><span class="space"> </span><span style="color:#C678DD">FROM</span><span class="space"> </span><span style="color:#C678DD">profile</span></span>
<span class="line"></span></code><button class="copy" data-code="SELECT * FROM profile
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>















<table><thead><tr><th align="left">id</th><th align="left">name</th><th align="left">email</th></tr></thead><tbody><tr><td align="left">4</td><td align="left">Magnus</td><td align="left"><a href="mailto:magnus2@gmail.com">magnus2@gmail.com</a></td></tr></tbody></table>
<p><strong>Result 2</strong></p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">SELECT</span><span class="space"> </span><span style="color:#ABB2BF">*</span><span class="space"> </span><span style="color:#C678DD">FROM</span><span class="space"> </span><span style="color:#ABB2BF">profile_audits</span></span>
<span class="line"></span></code><button class="copy" data-code="SELECT * FROM profile_audits
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>























<table><thead><tr><th align="left">id</th><th align="left">operation</th><th align="left">row</th><th align="left">changed_on</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">INSERT</td><td align="left">{‚Äúid‚Äù: 4, ‚Äúname‚Äù: ‚ÄúMagnus‚Äù, ‚Äúemail‚Äù: ‚Äú<a href="mailto:magnus@gmail.com">magnus@gmail.com</a>‚Äù}</td><td align="left">2022-02-28 07:39:36.313046</td></tr><tr><td align="left">2</td><td align="left">UPDATE</td><td align="left">{‚Äúid‚Äù: 4, ‚Äúname‚Äù: ‚ÄúMagnus‚Äù, ‚Äúemail‚Äù: ‚Äú<a href="mailto:magnus2@gmail.com">magnus2@gmail.com</a>‚Äù}</td><td align="left">2022-02-28 07:40:07.678714</td></tr></tbody></table>
<p>Looks good!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Triggers are a simple way of creating audit tables when using PostgreSQL. There are a few pros and cons worth mentioning.</p>
<h4 id="-pros">‚úÖ Pros</h4>
<ul>
<li>Makes troubleshooting easy, since all changes are tracked</li>
<li>Uses built-in postgres functionality - meaning we don‚Äôt have to reimplement the same logic in the application code.</li>
</ul>
<h4 id="-cons">‚ùå Cons</h4>
<ul>
<li>Moving application logic to the database CAN quite quickly become very messy. See some good comments on stored procedures <a href="https://softwareengineering.stackexchange.com/a/66084">here</a>. If an engineering organization wants to use these approaches, care should be take to discuss the pros and cons and common pitfalls.</li>
<li>Increased insert latency, and storage because <code>profile_audits</code> also needs to be populated.</li>
<li>Increased disk usage and costs</li>
</ul>
<h4 id="possible-next-steps">Possible next steps</h4>
<ul>
<li>
<p>In an event based system, the <code>profile_audits</code> can be used as a building block to periodically send out change events, like <code>ProfileCreated</code>, <code>ProfileUpdated</code>, <code>ProfileDeleted</code>.</p>
</li>
<li>
<p>We could also add more audit information, what caused the change to happen and whom. It would be interesting to distinguish whether an administrator or the user themselves updated it, for example. In an event based system, tracking the <strong>event id</strong> which caused the change might also be interesting.</p>
</li>
</ul>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=j6ow-UemzBc">Design Microservice Architectures the Right Way</a> - Michael Bryzek</li>
<li><a href="https://www.infoq.com/news/2018/07/bryzek-microservice-architecture/">Summary</a> of the video above</li>
<li><a href="https://datacater.io/blog/2021-09-02/postgresql-cdc-complete-guide.html">datacater.io: PostgreSQL Change Data Capture (CDC)</a></li>
<li><a href="https://wiki.postgresql.org/wiki/Audit_trigger_91plus">Built-in audit function in Postgres</a></li>
</ul> </article> </div> </div> <!--Col 3 --> <div class="col-3 border-l-2 pl-3 prose-li:decoration-0" data-astro-cid-vj4tpspi> <nav class="sticky top-5 prose prose-sm w-full"><h3 class="font-bold">Outline</h3><ul class="list-disc pl-4"><li><a href="#why-do-you-need-an-audit-table" class="text-blue-600 hover:underline">Why do you need an audit table?</a></li><li><a href="#the-tables" class="text-blue-600 hover:underline">The tables</a></li><li><a href="#linking-the-two-tables" class="text-blue-600 hover:underline">Linking the two tables</a></li><li><a href="#testing-everything" class="text-blue-600 hover:underline">Testing everything</a></li><li><a href="#conclusion" class="text-blue-600 hover:underline">Conclusion</a></li><li><a href="#-pros" class="text-blue-600 hover:underline">‚úÖ Pros</a></li><li><a href="#-cons" class="text-blue-600 hover:underline">‚ùå Cons</a></li><li><a href="#possible-next-steps" class="text-blue-600 hover:underline">Possible next steps</a></li><li><a href="#resources" class="text-blue-600 hover:underline">Resources</a></li></ul></nav> </div> </div> </div> <footer class="mt-auto" data-astro-cid-sz7xmlte> <div class="max-w-3xl mx-auto px-0"> <hr class="border-skin-line"> </div> <div class="footer-wrapper" data-astro-cid-sz7xmlte> <div class="social-icons flex" data-astro-cid-upu6fzxr> <a type="button" href="https://github.com/magnuswahlstrand" class="group link-button p-2 sm:p-1" title="Github" data-astro-cid-5eunqzkt>  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path
      d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
    ></path>
  </svg>  </a>  <a type="button" href="https://www.linkedin.com/in/magnus-wahlstrand" class="group link-button p-2 sm:p-1" title="Linkedin" data-astro-cid-5eunqzkt>  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="2"></rect>
    <line x1="8" y1="11" x2="8" y2="16"></line>
    <line x1="8" y1="8" x2="8" y2="8.01"></line>
    <line x1="12" y1="16" x2="12" y2="11"></line>
    <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
  </svg>  </a>  <a type="button" href="https://twitter.com/wahlstra" class="group link-button p-2 sm:p-1" title="Twitter" data-astro-cid-5eunqzkt>  <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
    </svg>  </a>   </div>  <!--<div class="copyright-wrapper">
      <span>Copyright &#169; {currentYear}</span>
      <span class="separator">&nbsp;|&nbsp;</span>
      <span>All rights reserved.</span>
    </div>--> </div> </footer>   <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;8095b63dcdb84f66a2a868f2c58a066a&quot;}"></script><!-- End Cloudflare Web Analytics --> </body><!-- Cloudflare Web Analytics --></html> 