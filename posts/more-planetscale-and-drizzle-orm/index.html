<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="canonical" href="https://wahlstrand.dev/posts/more-planetscale-and-drizzle-orm/"><meta name="generator" content="Astro v4.15.12"><!-- General Meta Tags --><title>More Planetscale and Drizzle ORM</title><meta name="title" content="More Planetscale and Drizzle ORM"><meta name="description" content="Made by a minimal, responsible and friendly person."><meta name="author" content="Magnus Wahlstrand"><!-- Open Graph / Facebook --><meta property="og:title" content="More Planetscale and Drizzle ORM"><meta property="og:description" content="Made by a minimal, responsible and friendly person."><meta property="og:url" content="https://wahlstrand.dev/posts/more-planetscale-and-drizzle-orm/"><meta property="og:image" content="https://wahlstrand.dev/default-og.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://wahlstrand.dev/posts/more-planetscale-and-drizzle-orm/"><meta property="twitter:title" content="More Planetscale and Drizzle ORM"><meta property="twitter:description" content="Made by a minimal, responsible and friendly person."><meta property="twitter:image" content="https://wahlstrand.dev/default-og.png"><!-- Google Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><script>
      const primaryColorScheme = "none"; // "light" | "dark" | "none"

      const darkModeMediaQuery = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;

      // Get theme data from local storage
      const currentTheme = localStorage.getItem("theme");

      let theme;

      // Set theme to 'theme-dark' if currentTheme is 'dark'
      if (currentTheme) {
        theme = currentTheme === "dark" ? "theme-dark" : "";
      } else {
        // If primary color scheme is dark
        // or primary color scheme is not set and prefers-color-scheme is dark
        // choose dark mode
        if (
          primaryColorScheme === "dark" ||
          (primaryColorScheme === "none" && darkModeMediaQuery)
        ) {
          theme = "theme-dark";
        }
        // If primary color scheme is light
        // choose light mode
        else if (primaryColorScheme === "light") {
          theme = "";
        }
        // fallback to prefers-color-scheme
        else {
          theme = darkModeMediaQuery ? "theme-dark" : "";
        }
      }

      // Put dark class on html tag to enable dark mode
      document.querySelector("html").className = theme;
    </script><link rel="stylesheet" href="/_astro/about.CNRB2s6F.css">
<link rel="stylesheet" href="/_astro/about.CFhNuVDC.css">
<style>.breadcrumb[data-astro-cid-ilhxcym7]{margin-left:auto;margin-right:auto;margin-top:2rem;margin-bottom:.25rem;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]{display:inline;text-transform:capitalize;opacity:.7}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]+li[data-astro-cid-ilhxcym7]{--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]+li[data-astro-cid-ilhxcym7]:before{--tw-content: ">";content:var(--tw-content)}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]:not(:last-child):hover{opacity:1}.breadcrumb[data-astro-cid-ilhxcym7] ul[data-astro-cid-ilhxcym7] li[data-astro-cid-ilhxcym7]:not(:last-child):hover:before{content:var(--tw-content);opacity:.7}#main-content[data-astro-cid-hsp6otuf]{margin-left:auto;margin-right:auto;width:100%;max-width:48rem;padding-left:1rem;padding-right:1rem;padding-bottom:3rem}#main-content[data-astro-cid-hsp6otuf] h1[data-astro-cid-hsp6otuf]{font-size:1.5rem;line-height:2rem;font-weight:600}@media (min-width: 640px){#main-content[data-astro-cid-hsp6otuf] h1[data-astro-cid-hsp6otuf]{font-size:1.875rem;line-height:2.25rem}}#main-content[data-astro-cid-hsp6otuf] p[data-astro-cid-hsp6otuf]{margin-top:.5rem;margin-bottom:1.5rem;font-style:italic}
a[data-astro-cid-blwjyjpt]{position:relative;text-decoration-line:underline;text-decoration-style:dashed}a[data-astro-cid-blwjyjpt]:hover{top:-.125rem;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}a[data-astro-cid-blwjyjpt]:focus-visible{padding:.25rem}a[data-astro-cid-blwjyjpt] svg[data-astro-cid-blwjyjpt]{margin-right:-.5rem;height:1.5rem;width:1.5rem;--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity));opacity:.8}.group[data-astro-cid-blwjyjpt]:hover a[data-astro-cid-blwjyjpt] svg[data-astro-cid-blwjyjpt]{fill:rgb(var(--color-accent))}
.col-1[data-astro-cid-vj4tpspi]{display:none}@media (min-width: 1280px){.col-1[data-astro-cid-vj4tpspi]{grid-column:span 3 / span 3;display:block}}.col-2[data-astro-cid-vj4tpspi]{grid-column:span 12 / span 12;padding-left:1rem;padding-right:1rem}@media (min-width: 1024px){.col-2[data-astro-cid-vj4tpspi]{grid-column:span 9 / span 9}}@media (min-width: 1280px){.col-2[data-astro-cid-vj4tpspi]{grid-column:span 6 / span 6}}.col-3[data-astro-cid-vj4tpspi]{display:none}@media (min-width: 1024px){.col-3[data-astro-cid-vj4tpspi]{grid-column:span 3 / span 3;display:block}}main[data-astro-cid-vj4tpspi]{margin-left:auto;margin-right:auto;width:100%;padding-left:.5rem;padding-right:.5rem;padding-bottom:3rem}#main-content-wrapper[data-astro-cid-vj4tpspi]{margin-left:auto;margin-right:auto}.post-title[data-astro-cid-vj4tpspi]{font-size:1.5rem;line-height:2rem;font-weight:600;--tw-text-opacity: 1;color:rgba(var(--color-accent),var(--tw-text-opacity))}.tags-container[data-astro-cid-vj4tpspi]{margin-top:.25rem;margin-bottom:.25rem;font-size:.875rem;line-height:1.25rem}.toc[data-astro-cid-vj4tpspi]{border-left-width:2px;padding-left:1rem;font-size:.75rem;line-height:1rem}
.pagination-wrapper[data-astro-cid-eenky23y]{margin-top:auto;margin-bottom:2rem;display:flex;justify-content:center}.disabled[data-astro-cid-eenky23y]{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;opacity:.5}.disabled[data-astro-cid-eenky23y]:hover{--tw-text-opacity: 1;color:rgba(var(--color-text-base),var(--tw-text-opacity))}.group[data-astro-cid-eenky23y]:hover .disabled[data-astro-cid-eenky23y]{fill:rgb(var(--color-text-base))}.group[data-astro-cid-eenky23y]:hover .disabled-svg[data-astro-cid-eenky23y]{fill:rgb(var(--color-text-base))!important}
.link-button[data-astro-cid-mm6olqhn]:hover{--tw-rotate: 6deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}
</style>
<link rel="stylesheet" href="/_astro/_slug_.DUJDte-_.css"><script type="module" src="/_astro/hoisted.yKWdqxaI.js"></script></head> <body>  <header data-astro-cid-3ef6ksr2> <a id="skip-to-content" href="#main-content" data-astro-cid-3ef6ksr2>Skip to content</a> <div class="nav-container" data-astro-cid-3ef6ksr2> <div class="top-nav-wrap" data-astro-cid-3ef6ksr2> <a href="/" class="logo break-keep text-2xl" data-astro-cid-3ef6ksr2> Magnus Wahlstrand </a> <button class="hamburger-menu" aria-label="menu" data-astro-cid-3ef6ksr2> <div class="icon-container flex" data-astro-cid-3ef6ksr2> <div id="first-line" data-astro-cid-3ef6ksr2></div> <div id="second-line" data-astro-cid-3ef6ksr2></div> <div id="third-line" data-astro-cid-3ef6ksr2></div> </div> </button> </div> <nav class="display-none sm:flex" data-astro-cid-3ef6ksr2> <ul data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/resume" class="" data-astro-cid-3ef6ksr2>Resum√©</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/posts" class="" data-astro-cid-3ef6ksr2>Posts</a> </li> <!--
        <li>
          <a href="/tags" class={activeNav === "tags" ? "active" : ""}>Tags</a>
        </li>
        --> <li data-astro-cid-3ef6ksr2> <a href="/about" class="" data-astro-cid-3ef6ksr2>About</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/now" class="" data-astro-cid-3ef6ksr2>Now</a> </li> </ul> <div class="button-wrapper sm:display-none" data-astro-cid-3ef6ksr2> <a type="button" href="/search" class="group focus-outline p-1 " aria-label="search" title="Search" data-astro-cid-5eunqzkt>  <svg xmlns="http://www.w3.org/2000/svg" data-astro-cid-3ef6ksr2><path d="M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z" data-astro-cid-3ef6ksr2></path> </svg>  </a>  <button id="theme-btn" class="focus-outline" aria-label="switch theme" data-astro-cid-3ef6ksr2> <svg xmlns="http://www.w3.org/2000/svg" id="moon-svg" data-astro-cid-3ef6ksr2> <path d="M20.742 13.045a8.088 8.088 0 0 1-2.077.271c-2.135 0-4.14-.83-5.646-2.336a8.025 8.025 0 0 1-2.064-7.723A1 1 0 0 0 9.73 2.034a10.014 10.014 0 0 0-4.489 2.582c-3.898 3.898-3.898 10.243 0 14.143a9.937 9.937 0 0 0 7.072 2.93 9.93 9.93 0 0 0 7.07-2.929 10.007 10.007 0 0 0 2.583-4.491 1.001 1.001 0 0 0-1.224-1.224zm-2.772 4.301a7.947 7.947 0 0 1-5.656 2.343 7.953 7.953 0 0 1-5.658-2.344c-3.118-3.119-3.118-8.195 0-11.314a7.923 7.923 0 0 1 2.06-1.483 10.027 10.027 0 0 0 2.89 7.848 9.972 9.972 0 0 0 7.848 2.891 8.036 8.036 0 0 1-1.484 2.059z" data-astro-cid-3ef6ksr2></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" id="sun-svg" data-astro-cid-3ef6ksr2> <path d="M6.993 12c0 2.761 2.246 5.007 5.007 5.007s5.007-2.246 5.007-5.007S14.761 6.993 12 6.993 6.993 9.239 6.993 12zM12 8.993c1.658 0 3.007 1.349 3.007 3.007S13.658 15.007 12 15.007 8.993 13.658 8.993 12 10.342 8.993 12 8.993zM10.998 19h2v3h-2zm0-17h2v3h-2zm-9 9h3v2h-3zm17 0h3v2h-3zM4.219 18.363l2.12-2.122 1.415 1.414-2.12 2.122zM16.24 6.344l2.122-2.122 1.414 1.414-2.122 2.122zM6.342 7.759 4.22 5.637l1.415-1.414 2.12 2.122zm13.434 10.605-1.414 1.414-2.122-2.122 1.414-1.414z" data-astro-cid-3ef6ksr2></path> </svg> </button> </div> </nav> </div> <div class="max-w-3xl mx-auto px-4"> <hr class="border-skin-line"> </div> </header>   <div class="" data-astro-cid-vj4tpspi> <div class="mx-auto grid grid-cols-12 max-w-7xl" data-astro-cid-vj4tpspi> <div class="col-1" data-astro-cid-vj4tpspi></div> <div class="col-2" data-astro-cid-vj4tpspi> <button class="mt-8 mb-2 hover:opacity-75 flex focus-outline" onclick="history.back()"> <svg xmlns="http://www.w3.org/2000/svg"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"></path> </svg> <span>Go back</span> </button> <div class="justify-start mx-auto" data-astro-cid-vj4tpspi> <h1 class="post-title" data-astro-cid-vj4tpspi>More Planetscale and Drizzle ORM</h1> <div class="opacity-80 flex items-center space-x-2 my-2"><svg xmlns="http://www.w3.org/2000/svg" class="scale-100 w-6 h-6 inline-block fill-skin-base"><path d="M7 11h2v2H7zm0 4h2v2H7zm4-4h2v2h-2zm0 4h2v2h-2zm4-4h2v2h-2zm0 4h2v2h-2z"></path><path d="M5 22h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2zM19 8l.001 12H5V8h14z"></path></svg><span class="italic text-base">April 15, 2023</span></div> <ul class="tags-container" data-astro-cid-vj4tpspi> <li class="inline-block my-1 underline-offset-4" data-astro-cid-blwjyjpt> <a href="/tags/planetscale" class="pr-1 text-sm group" data-astro-cid-blwjyjpt> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75" data-astro-cid-blwjyjpt> <path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" data-astro-cid-blwjyjpt></path> </svg>
&nbsp;<span data-astro-cid-blwjyjpt>planetscale</span> </a> </li> <li class="inline-block my-1 underline-offset-4" data-astro-cid-blwjyjpt> <a href="/tags/drizzle-orm" class="pr-1 text-sm group" data-astro-cid-blwjyjpt> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75" data-astro-cid-blwjyjpt> <path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" data-astro-cid-blwjyjpt></path> </svg>
&nbsp;<span data-astro-cid-blwjyjpt>drizzle-orm</span> </a> </li> <li class="inline-block my-1 underline-offset-4" data-astro-cid-blwjyjpt> <a href="/tags/typescript" class="pr-1 text-sm group" data-astro-cid-blwjyjpt> <svg xmlns="http://www.w3.org/2000/svg" class=" scale-75" data-astro-cid-blwjyjpt> <path d="M16.018 3.815 15.232 8h-4.966l.716-3.815-1.964-.37L8.232 8H4v2h3.857l-.751 4H3v2h3.731l-.714 3.805 1.965.369L8.766 16h4.966l-.714 3.805 1.965.369.783-4.174H20v-2h-3.859l.751-4H21V8h-3.733l.716-3.815-1.965-.37zM14.106 14H9.141l.751-4h4.966l-.752 4z" data-astro-cid-blwjyjpt></path> </svg>
&nbsp;<span data-astro-cid-blwjyjpt>typescript</span> </a> </li>  </ul> </div> </div> <div class="col-3" data-astro-cid-vj4tpspi></div> </div> <div class="mx-auto grid grid-cols-12 max-w-7xl mt-4" data-astro-cid-vj4tpspi> <!--Col 1 --> <div class="col-1" data-astro-cid-vj4tpspi></div> <!--Col 2 --> <div class="col-2" data-astro-cid-vj4tpspi> <div data-astro-cid-vj4tpspi> <article id="article" role="article" class="prose max-w-3xl mb-24" data-astro-cid-vj4tpspi> <p>In this article we create a simple <code>users-cli</code> to store and list user information in a database hosted by <a href="https://planetscale.com/">Planetscale</a>, using <a href="https://drizzle-orm.com/">Drizzle ORM</a> for type-safety.</p>
<p>For more information about Planetscale and Drizzle ORM on AWS, check out my previous post <a href="/posts/sst-planetscale-and-drizzle-orm/">SST, Planetscale and Drizzle ORM</a>.</p>
<h2 id="initialize-the-project">Initialize the project</h2>
<p>First of all, let‚Äôs initialize our repo</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#61AFEF">mkdir</span><span class="space"> </span><span style="color:#98C379">drizzle-planetscale-example</span></span>
<span class="line"><span style="color:#56B6C2">cd</span><span class="space"> </span><span style="color:#98C379">drizzle-planetscale-example</span></span>
<span class="line"><span style="color:#61AFEF">npm</span><span class="space"> </span><span style="color:#98C379">init</span><span class="space"> </span><span style="color:#D19A66">-y</span></span>
<span class="line"><span style="color:#61AFEF">npm</span><span class="space"> </span><span style="color:#98C379">install</span><span class="space"> </span><span style="color:#98C379">typescript</span><span class="space"> </span><span style="color:#98C379">ts-node</span><span class="space"> </span><span style="color:#98C379">@types/node</span></span>
<span class="line"><span style="color:#61AFEF">npx</span><span class="space"> </span><span style="color:#98C379">tsc</span><span class="space"> </span><span style="color:#D19A66">--init</span></span>
<span class="line"></span></code><button class="copy" data-code="mkdir drizzle-planetscale-example
cd drizzle-planetscale-example
npm init -y
npm install typescript ts-node @types/node
npx tsc --init
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h2 id="initial-code">Initial code</h2>
<p>Next we create a basic cli application</p>
<ol start="2">
<li>Create <strong>index.ts</strong></li>
</ol>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Usage:"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"</span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">users-db-cli.ts</span><span class="space"> </span><span style="color:#98C379">--list</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">-</span><span class="space"> </span><span style="color:#98C379">fetch</span><span class="space"> </span><span style="color:#98C379">all</span><span class="space"> </span><span style="color:#98C379">users"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"</span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">users-db-cli.ts</span><span class="space"> </span><span style="color:#98C379">--add</span><span class="space"> </span><span style="color:#98C379">&#x3C;name></span><span class="space"> </span><span style="color:#98C379">-</span><span class="space"> </span><span style="color:#98C379">add</span><span class="space"> </span><span style="color:#98C379">a</span><span class="space"> </span><span style="color:#98C379">user"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exit</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">main</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">argv</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span class="space"> </span><span style="color:#56B6C2">&#x3C;</span><span class="space"> </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">flag</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">argv</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">];</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">value</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">argv</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">flag</span><span class="space"> </span><span style="color:#56B6C2">===</span><span class="space"> </span><span style="color:#98C379">"--add"</span><span class="space"> </span><span style="color:#56B6C2">&#x26;&#x26;</span><span class="space"> </span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">addUser</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">else</span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">flag</span><span class="space"> </span><span style="color:#56B6C2">===</span><span class="space"> </span><span style="color:#98C379">"--list"</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">listUsers</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">else</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">listUsers</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"List</span><span class="space"> </span><span style="color:#98C379">users"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">addUser</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">name</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Add</span><span class="space"> </span><span style="color:#98C379">user"</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">main</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">then</span><span style="color:#ABB2BF">(()</span><span class="space"> </span><span style="color:#C678DD">=></span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Success!"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">})</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">catch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">err</span><span class="space"> </span><span style="color:#C678DD">=></span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Error"</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">err</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">});</span></span>
<span class="line"></span></code><button class="copy" data-code="function usage() {
  console.log(&#x22;Usage:&#x22;);
  console.log(&#x22;  users-db-cli.ts --list       - fetch all users&#x22;);
  console.log(&#x22;  users-db-cli.ts --add <name> - add a user&#x22;);
  process.exit(1);
}

async function main() {
  if (process.argv.length < 3) {
    usage();
  }

  const flag = process.argv[2];
  const value = process.argv[3];

  if (flag === &#x22;--add&#x22; &#x26;&#x26; value) {
    await addUser(value);
  } else if (flag === &#x22;--list&#x22;) {
    await listUsers();
  } else {
    usage();
  }
}

async function listUsers() {
  console.log(&#x22;List users&#x22;);
}

async function addUser(name: string) {
  console.log(&#x22;Add user&#x22;, name);
}

main()
  .then(() => {
    console.log(&#x22;Success!&#x22;);
  })
  .catch(err => {
    console.log(&#x22;Error&#x22;, err);
  });
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h4 id="test-run">Test run</h4>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#ABB2BF">></span><span class="space"> </span><span style="color:#ABB2BF">npx</span><span class="space"> </span><span style="color:#ABB2BF">ts-node</span><span class="space"> </span><span style="color:#ABB2BF">index.ts</span><span class="space"> </span><span style="color:#ABB2BF">--add</span><span class="space"> </span><span style="color:#ABB2BF">magnus</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">Add</span><span class="space"> </span><span style="color:#98C379">user</span><span class="space"> </span><span style="color:#98C379">magnus</span></span>
<span class="line"><span style="color:#61AFEF">Success!</span></span>
<span class="line"></span></code><button class="copy" data-code="> npx ts-node index.ts --add magnus

Add user magnus
Success!
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h2 id="setup-planetscale">Setup Planetscale</h2>
<ul>
<li>First, install the planetscale database driver</li>
</ul>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#61AFEF">npm</span><span class="space"> </span><span style="color:#98C379">install</span><span class="space"> </span><span style="color:#98C379">@planetscale/database</span></span>
<span class="line"></span></code><button class="copy" data-code="npm install @planetscale/database
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<ul>
<li>Go to <a href="https://app.planetscale.com/">https://app.planetscale.com/</a> and sign up.</li>
<li>Follow the instructions to initialize the planetscale CLI and connect to your database.</li>
<li>Now we can connect to our database <strong>(magnusscale)</strong> and create to our table</li>
</ul>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#ABB2BF">></span><span class="space"> </span><span style="color:#ABB2BF">pscale</span><span class="space"> </span><span style="color:#ABB2BF">shell</span><span class="space"> </span><span style="color:#ABB2BF">magnusscale</span><span class="space"> </span><span style="color:#ABB2BF">main</span></span>
<span class="line"><span style="color:#61AFEF">magnusscale/main</span><span style="color:#ABB2BF">></span></span>
<span class="line"></span></code><button class="copy" data-code="> pscale shell magnusscale main
magnusscale/main>
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>Create our users table</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#C678DD">CREATE</span><span class="space"> </span><span style="color:#C678DD">TABLE</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">users</span></span>
<span class="line"><span style="color:#ABB2BF">(</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">id</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">INT</span><span class="space"> </span><span style="color:#ABB2BF">UNSIGNED</span><span class="space"> </span><span style="color:#ABB2BF">AUTO_INCREMENT</span><span class="space"> </span><span style="color:#C678DD">PRIMARY</span><span class="space"> </span><span style="color:#C678DD">KEY</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">name</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">VARCHAR</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">255</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#C678DD">NOT</span><span class="space"> </span><span style="color:#C678DD">NULL</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">created_at</span><span class="space"> </span><span style="color:#C678DD">TIMESTAMP</span><span class="space"> </span><span style="color:#C678DD">DEFAULT</span><span class="space"> </span><span style="color:#ABB2BF">CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="color:#ABB2BF">);</span></span>
<span class="line"></span></code><button class="copy" data-code="CREATE TABLE
    users
(
    id         INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name       VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>Done!</p>
<h2 id="setup-drizzle-orm">Setup drizzle-orm</h2>
<ol>
<li>Install drizzle-orm and the mysql2 driver</li>
</ol>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#61AFEF">npm</span><span class="space"> </span><span style="color:#98C379">i</span><span class="space"> </span><span style="color:#98C379">drizzle-orm</span><span class="space"> </span><span style="color:#98C379">mysql2</span></span>
<span class="line"></span></code><button class="copy" data-code="npm i drizzle-orm mysql2
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<ol start="2">
<li>Create <strong>schema.ts</strong></li>
</ol>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#C678DD">import</span><span class="space"> </span><span style="color:#ABB2BF">{</span><span class="space"> </span><span style="color:#E06C75">int</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">mysqlTable</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">text</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">timestamp</span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">from</span><span class="space"> </span><span style="color:#98C379">"drizzle-orm/mysql-core"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">usersTable</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#61AFEF">mysqlTable</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"users"</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">id</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#61AFEF">int</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"id"</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">autoincrement</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">primaryKey</span><span style="color:#ABB2BF">(),</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#61AFEF">text</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"name"</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">notNull</span><span style="color:#ABB2BF">(),</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">created_at</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#61AFEF">timestamp</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"created_at"</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">notNull</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">defaultNow</span><span style="color:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#ABB2BF">});</span></span>
<span class="line"></span></code><button class="copy" data-code="import { int, mysqlTable, text, timestamp } from &#x22;drizzle-orm/mysql-core&#x22;;

export const usersTable = mysqlTable(&#x22;users&#x22;, {
  id: int(&#x22;id&#x22;).autoincrement().primaryKey(),
  name: text(&#x22;name&#x22;).notNull(),
  created_at: timestamp(&#x22;created_at&#x22;).notNull().defaultNow(),
});
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<ol start="3">
<li>Create <strong>db.ts</strong></li>
</ol>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#C678DD">import</span><span class="space"> </span><span style="color:#ABB2BF">{</span><span class="space"> </span><span style="color:#E06C75">connect</span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">from</span><span class="space"> </span><span style="color:#98C379">"@planetscale/database"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span class="space"> </span><span style="color:#ABB2BF">{</span><span class="space"> </span><span style="color:#E06C75">usersTable</span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">from</span><span class="space"> </span><span style="color:#98C379">"./schema"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">import</span><span class="space"> </span><span style="color:#ABB2BF">{</span><span class="space"> </span><span style="color:#E06C75">drizzle</span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">from</span><span class="space"> </span><span style="color:#98C379">"drizzle-orm/planetscale-serverless"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">connection</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#61AFEF">connect</span><span style="color:#ABB2BF">({</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">host</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#98C379">"aws.connect.psdb.cloud"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">username</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">PLANETSCALE_USERNAME</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">password</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">env</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">PLANETSCALE_PASSWORD</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">});</span></span>
<span class="line"><span style="color:#C678DD">export</span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">db</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#61AFEF">drizzle</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">connection</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span class="space"> </span><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">addUserToDb</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">name</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#E5C07B">db</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">insert</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">usersTable</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">values</span><span style="color:#ABB2BF">({</span><span class="space"> </span><span style="color:#E06C75">name</span><span class="space"> </span><span style="color:#ABB2BF">});</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">export</span><span class="space"> </span><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">listUsersFromDb</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">return</span><span class="space"> </span><span style="color:#E5C07B">db</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">select</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">from</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">usersTable</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code><button class="copy" data-code="import { connect } from &#x22;@planetscale/database&#x22;;
import { usersTable } from &#x22;./schema&#x22;;
import { drizzle } from &#x22;drizzle-orm/planetscale-serverless&#x22;;

const connection = connect({
  host: &#x22;aws.connect.psdb.cloud&#x22;,
  username: process.env.PLANETSCALE_USERNAME,
  password: process.env.PLANETSCALE_PASSWORD,
});
export const db = drizzle(connection);

export async function addUserToDb(name: string) {
  await db.insert(usersTable).values({ name });
}

export async function listUsersFromDb() {
  return db.select().from(usersTable);
}
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<ol start="4">
<li>Get the planetscale credentials and store somewhere. I use <code>direnv</code> and an <code>.env</code> file</li>
</ol>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#E06C75">PLANETSCALE_USERNAME</span><span style="color:#56B6C2">=</span><span style="color:#98C379">cgiyexqws13g...</span></span>
<span class="line"><span style="color:#E06C75">PLANETSCALE_PASSWORD</span><span style="color:#56B6C2">=</span><span style="color:#98C379">pscale_pw_2R...</span></span>
<span class="line"></span></code><button class="copy" data-code="PLANETSCALE_USERNAME=cgiyexqws13g...
PLANETSCALE_PASSWORD=pscale_pw_2R...
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h2 id="update-users-cli">Update users-cli</h2>
<p>Now we can import and use the db functions in <em>users-cli.ts</em>.</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#C678DD">import</span><span class="space"> </span><span style="color:#ABB2BF">{</span><span class="space"> </span><span style="color:#E06C75">addUserToDb</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">listUsersFromDb</span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">from</span><span class="space"> </span><span style="color:#98C379">"./db"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Usage:"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"</span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">users-db-cli.ts</span><span class="space"> </span><span style="color:#98C379">--list</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">-</span><span class="space"> </span><span style="color:#98C379">fetch</span><span class="space"> </span><span style="color:#98C379">all</span><span class="space"> </span><span style="color:#98C379">users"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"</span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">users-db-cli.ts</span><span class="space"> </span><span style="color:#98C379">--add</span><span class="space"> </span><span style="color:#98C379">&#x3C;name></span><span class="space"> </span><span style="color:#98C379">-</span><span class="space"> </span><span style="color:#98C379">add</span><span class="space"> </span><span style="color:#98C379">a</span><span class="space"> </span><span style="color:#98C379">user"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exit</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">main</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">argv</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span class="space"> </span><span style="color:#56B6C2">&#x3C;</span><span class="space"> </span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">flag</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">argv</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">];</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">value</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#E5C07B">process</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">argv</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">flag</span><span class="space"> </span><span style="color:#56B6C2">===</span><span class="space"> </span><span style="color:#98C379">"--add"</span><span class="space"> </span><span style="color:#56B6C2">&#x26;&#x26;</span><span class="space"> </span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">addUser</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">else</span><span class="space"> </span><span style="color:#C678DD">if</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">flag</span><span class="space"> </span><span style="color:#56B6C2">===</span><span class="space"> </span><span style="color:#98C379">"--list"</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">listUsers</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span><span class="space"> </span><span style="color:#C678DD">else</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#61AFEF">usage</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">padding</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">listUsers</span><span style="color:#ABB2BF">()</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">users</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">listUsersFromDb</span><span style="color:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#7F848E;font-style:italic">//</span><span class="space"> </span><span style="color:#7F848E;font-style:italic">Print</span><span class="space"> </span><span style="color:#7F848E;font-style:italic">users</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"ID"</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">padEnd</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">),</span><span class="space"> </span><span style="color:#98C379">"Name"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">for</span><span class="space"> </span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">u</span><span class="space"> </span><span style="color:#C678DD">of</span><span class="space"> </span><span style="color:#E06C75">users</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">const</span><span class="space"> </span><span style="color:#E5C07B">paddedId</span><span class="space"> </span><span style="color:#56B6C2">=</span><span class="space"> </span><span style="color:#E5C07B">u</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toString</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">padEnd</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">padding</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">paddedId</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E5C07B">u</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">async</span><span class="space"> </span><span style="color:#C678DD">function</span><span class="space"> </span><span style="color:#61AFEF">addUser</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">name</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">)</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#C678DD">await</span><span class="space"> </span><span style="color:#61AFEF">addUserToDb</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">`Added</span><span class="space"> </span><span style="color:#98C379">user</span><span class="space"> </span><span style="color:#C678DD">${</span><span style="color:#E06C75">name</span><span style="color:#C678DD">}</span><span style="color:#98C379">!`</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF">main</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">then</span><span style="color:#ABB2BF">(()</span><span class="space"> </span><span style="color:#C678DD">=></span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Success!"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">})</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">catch</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75;font-style:italic">err</span><span class="space"> </span><span style="color:#C678DD">=></span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E5C07B">console</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">log</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"Error"</span><span style="color:#ABB2BF">,</span><span class="space"> </span><span style="color:#E06C75">err</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">});</span></span>
<span class="line"></span></code><button class="copy" data-code="import { addUserToDb, listUsersFromDb } from &#x22;./db&#x22;;

function usage() {
  console.log(&#x22;Usage:&#x22;);
  console.log(&#x22;  users-db-cli.ts --list       - fetch all users&#x22;);
  console.log(&#x22;  users-db-cli.ts --add <name> - add a user&#x22;);
  process.exit(1);
}

async function main() {
  if (process.argv.length < 3) {
    usage();
  }

  const flag = process.argv[2];
  const value = process.argv[3];

  if (flag === &#x22;--add&#x22; &#x26;&#x26; value) {
    await addUser(value);
  } else if (flag === &#x22;--list&#x22;) {
    await listUsers();
  } else {
    usage();
  }
}

const padding = 10;

async function listUsers() {
  const users = await listUsersFromDb();

  // Print users
  console.log(&#x22;ID&#x22;.padEnd(padding), &#x22;Name&#x22;);
  for (const u of users) {
    const paddedId = u.id.toString().padEnd(padding);
    console.log(paddedId, u.name);
  }
}

async function addUser(name: string) {
  await addUserToDb(name);
  console.log(&#x60;Added user ${name}!&#x60;);
}

main()
  .then(() => {
    console.log(&#x22;Success!&#x22;);
  })
  .catch(err => {
    console.log(&#x22;Error&#x22;, err);
  });
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h2 id="typesafety">Typesafety!</h2>
<p>What is really cool here, is that we get typesafety for free. Two examples:</p>
<ol>
<li>
<p><em>If we try to add a user without a name, we get a compile error.</em>
<img src="/img/planetscale-and-drizzle-orm-cli/add-user.png" alt="adding user without name"></p>
</li>
<li>
<p><em>The type returned from <code>listUsersFromDb()</code> is also typed!</em>
<img src="/img/planetscale-and-drizzle-orm-cli/list-users.png" alt="list is typesafe"></p>
</li>
</ol>
<h2 id="configure-ts-node-and-ts">Configure ts-node and ts</h2>
<p>Finally, we need to configure <code>ts-node</code> and ts correctly so that we can run the CLI. I use the following tsconfig.json
and ts-node.json to make it work with esm and node resolution. <strong>Note:</strong> I spent about 2 hours trying to get this to
work. ü•¥</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"ts-node"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"esm"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"experimentalSpecifierResolution"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#98C379">"node"</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">},</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"compilerOptions"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"target"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#98C379">"es2016"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"module"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#98C379">"ESNext"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"moduleResolution"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#98C379">"node"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"esModuleInterop"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"forceConsistentCasingInFileNames"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"strict"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#E06C75">"skipLibCheck"</span><span style="color:#ABB2BF">:</span><span class="space"> </span><span style="color:#D19A66">true</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"></span></code><button class="copy" data-code="{
  &#x22;ts-node&#x22;: {
    &#x22;esm&#x22;: true,
    &#x22;experimentalSpecifierResolution&#x22;: &#x22;node&#x22;
  },
  &#x22;compilerOptions&#x22;: {
    &#x22;target&#x22;: &#x22;es2016&#x22;,
    &#x22;module&#x22;: &#x22;ESNext&#x22;,
    &#x22;moduleResolution&#x22;: &#x22;node&#x22;,
    &#x22;esModuleInterop&#x22;: true,
    &#x22;forceConsistentCasingInFileNames&#x22;: true,
    &#x22;strict&#x22;: true,
    &#x22;skipLibCheck&#x22;: true
  }
}
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<h2 id="using-the-cli">Using the CLI</h2>
<p>Let‚Äôs add some users‚Ä¶</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#ABB2BF">></span><span class="space"> </span><span style="color:#ABB2BF">npx</span><span class="space"> </span><span style="color:#ABB2BF">ts-node</span><span class="space"> </span><span style="color:#ABB2BF">index.ts</span><span class="space"> </span><span style="color:#ABB2BF">--add</span><span class="space"> </span><span style="color:#ABB2BF">magnus</span></span>
<span class="line"><span style="color:#ABB2BF">></span><span class="space"> </span><span style="color:#ABB2BF">npx</span><span class="space"> </span><span style="color:#ABB2BF">ts-node</span><span class="space"> </span><span style="color:#ABB2BF">index.ts</span><span class="space"> </span><span style="color:#ABB2BF">--add</span><span class="space"> </span><span style="color:#ABB2BF">eve</span></span>
<span class="line"></span></code><button class="copy" data-code="> npx ts-node index.ts --add magnus
> npx ts-node index.ts --add eve
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>‚Ä¶and list them</p>
<pre class="astro-code one-dark-pro" style="background-color:#282c34;color:#abb2bf; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#ABB2BF">></span><span class="space"> </span><span style="color:#ABB2BF">npx</span><span class="space"> </span><span style="color:#ABB2BF">ts-node</span><span class="space"> </span><span style="color:#ABB2BF">index.ts</span><span class="space"> </span><span style="color:#ABB2BF">--list</span></span>
<span class="line"><span style="color:#61AFEF">ID</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">Name</span></span>
<span class="line"><span style="color:#61AFEF">-----</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#D19A66">-----</span></span>
<span class="line"><span style="color:#61AFEF">1</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">magnus</span></span>
<span class="line"><span style="color:#61AFEF">2</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="color:#98C379">eve</span></span>
<span class="line"></span></code><button class="copy" data-code="> npx ts-node index.ts --list
ID        Name
-----      -----
1         magnus
2         eve
" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 500)
        "><span class="ready"></span><span class="success"></span></button></pre>
<p>Cool stuff! üéâ</p>
<h1 id="conclusion">Conclusion</h1>
<ol>
<li>Drizzle-orm is awesome! It‚Äôs so easy to use and it‚Äôs typesafe!</li>
<li>Planetscale is also great. Super smooth onboarding and easy to use.</li>
<li>Configure ts-node and ts correctly with ESM modules is hell üòÖ</li>
</ol>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://github.com/drizzle-team/drizzle-orm/blob/main/drizzle-orm/src/mysql-core/README.md#connect-using-planetscale-serverless-client">Drizzle ORM</a> - connect using PlanetScale Serverless client</li>
<li><a href="https://github.com/magnuswahlstrand/drizzle-planetscale-example">github.com/magnuswahlstrand/drizzle-planetscale-example</a> - the code from this post</li>
</ul> </article> </div> </div> <!--Col 3 --> <div class="col-3 border-l-2 pl-3 prose-li:decoration-0" data-astro-cid-vj4tpspi> <nav class="sticky top-5 prose prose-sm w-full"><h3 class="font-bold">Outline</h3><ul class="list-disc pl-4"><li><a href="#initialize-the-project" class="text-blue-600 hover:underline">Initialize the project</a></li><li><a href="#initial-code" class="text-blue-600 hover:underline">Initial code</a></li><ul class="list-disc pl-4"></ul><li><a href="#setup-planetscale" class="text-blue-600 hover:underline">Setup Planetscale</a></li><li><a href="#setup-drizzle-orm" class="text-blue-600 hover:underline">Setup drizzle-orm</a></li><li><a href="#update-users-cli" class="text-blue-600 hover:underline">Update users-cli</a></li><li><a href="#typesafety" class="text-blue-600 hover:underline">Typesafety!</a></li><li><a href="#configure-ts-node-and-ts" class="text-blue-600 hover:underline">Configure ts-node and ts</a></li><li><a href="#using-the-cli" class="text-blue-600 hover:underline">Using the CLI</a></li><li><a href="#conclusion" class="text-blue-600 hover:underline">Conclusion</a></li><li><a href="#links" class="text-blue-600 hover:underline">Links</a></li></ul></nav> </div> </div> </div> <footer class="mt-auto" data-astro-cid-sz7xmlte> <div class="max-w-3xl mx-auto px-0"> <hr class="border-skin-line"> </div> <div class="footer-wrapper" data-astro-cid-sz7xmlte> <div class="social-icons flex" data-astro-cid-upu6fzxr> <a type="button" href="https://github.com/magnuswahlstrand" class="group link-button p-2 sm:p-1" title="Github" data-astro-cid-5eunqzkt>  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <path
      d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
    ></path>
  </svg>  </a>  <a type="button" href="https://www.linkedin.com/in/magnus-wahlstrand" class="group link-button p-2 sm:p-1" title="Linkedin" data-astro-cid-5eunqzkt>  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="icon-tabler"
    stroke-linecap="round"
    stroke-linejoin="round"
  >
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <rect x="4" y="4" width="16" height="16" rx="2"></rect>
    <line x1="8" y1="11" x2="8" y2="16"></line>
    <line x1="8" y1="8" x2="8" y2="8.01"></line>
    <line x1="12" y1="16" x2="12" y2="11"></line>
    <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
  </svg>  </a>  <a type="button" href="https://twitter.com/wahlstra" class="group link-button p-2 sm:p-1" title="Twitter" data-astro-cid-5eunqzkt>  <svg
      xmlns="http://www.w3.org/2000/svg"
      class="icon-tabler"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z"></path>
    </svg>  </a>   </div>  <!--<div class="copyright-wrapper">
      <span>Copyright &#169; {currentYear}</span>
      <span class="separator">&nbsp;|&nbsp;</span>
      <span>All rights reserved.</span>
    </div>--> </div> </footer>   <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;8095b63dcdb84f66a2a868f2c58a066a&quot;}"></script><!-- End Cloudflare Web Analytics --> </body><!-- Cloudflare Web Analytics --></html> 